# دعم العملات في نظام الألعاب

## نظرة عامة
تم تحديث نظام الألعاب لدعم تحديد العملة لكل لعبة، مما يوفر مرونة أكبر في عرض الأسعار للمستخدمين من مختلف البلدان.

## التحسينات المطبقة

### 1. إضافة enum للعملات المدعومة
```typescript
export enum Currency {
    EGP = 'EGP',  // الجنيه المصري
    USD = 'USD',  // الدولار الأمريكي
    EUR = 'EUR',  // اليورو
    SAR = 'SAR',  // الريال السعودي
    AED = 'AED'   // الدرهم الإماراتي
}
```

### 2. تحديث Game Schema
- إضافة حقل `currency` من نوع `Currency`
- تعيين `EGP` كعملة افتراضية
- فهرسة الحقل لتحسين الأداء

### 3. تحديث DTOs
- إضافة حقل `currency` اختياري في `CreateGameDto`
- دعم تحديث العملة في `UpdateGameDto`
- التحقق من صحة العملة باستخدام `@IsEnum(Currency)`

### 4. تحديث Game Service
- **إنشاء الألعاب**: تعيين `EGP` كعملة افتراضية إذا لم يتم تحديدها
- **تحديث الألعاب**: الحفاظ على العملة الحالية أو تعيين `EGP` كافتراضي
- **عرض الألعاب**: إضافة حقل `currency` في جميع استعلامات العرض

## الميزات الجديدة

### 1. مرونة في التسعير
- كل لعبة يمكن أن تحمل عملتها الخاصة
- دعم العملات الإقليمية المختلفة
- سهولة إدارة الأسعار للأسواق المختلفة

### 2. تجربة مستخدم محسنة
- عرض السعر مع العملة المناسبة
- وضوح أكبر في المعلومات المالية
- دعم أفضل للمستخدمين الدوليين

### 3. إدارة متقدمة
- إمكانية تحديد العملة عند إنشاء اللعبة
- تحديث العملة للألعاب الموجودة
- الحفاظ على التوافق مع البيانات الحالية

## أمثلة الاستخدام

### إنشاء لعبة بعملة محددة
```json
{
  "name": "FIFA 2024",
  "description": "لعبة كرة القدم الشهيرة",
  "type": "steam",
  "price": 59.99,
  "currency": "USD",
  "categoryId": "64f8a1b2c3d4e5f6a7b8c9d0"
}
```

### إنشاء لعبة بالعملة الافتراضية
```json
{
  "name": "Call of Duty",
  "description": "لعبة إطلاق نار",
  "type": "steam",
  "price": 1200,
  "categoryId": "64f8a1b2c3d4e5f6a7b8c9d0"
  // سيتم تعيين currency: "EGP" تلقائياً
}
```

### تحديث عملة لعبة موجودة
```json
{
  "currency": "SAR",
  "price": 220
}
```

## استجابة API

### عرض تفاصيل اللعبة
```json
{
  "success": true,
  "data": {
    "_id": "64f8a1b2c3d4e5f6a7b8c9d0",
    "name": "FIFA 2024",
    "description": "لعبة كرة القدم الشهيرة",
    "price": 59.99,
    "currency": "USD",
    "type": "steam",
    "isActive": true,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### قائمة الألعاب
```json
{
  "success": true,
  "data": [
    {
      "_id": "64f8a1b2c3d4e5f6a7b8c9d0",
      "name": "FIFA 2024",
      "price": 59.99,
      "currency": "USD"
    },
    {
      "_id": "64f8a1b2c3d4e5f6a7b8c9d1",
      "name": "Assassin's Creed",
      "price": 1500,
      "currency": "EGP"
    }
  ],
  "pagination": {
    "total": 2,
    "totalPages": 1,
    "currentPage": 1
  }
}
```

## التوافق مع النظام الحالي

### الألعاب الموجودة
- الألعاب التي لا تحتوي على حقل `currency` ستحصل على `EGP` كقيمة افتراضية
- لا حاجة لتعديل البيانات الموجودة يدوياً
- النظام يتعامل تلقائياً مع الحالات المختلفة

### APIs المحدثة
- جميع endpoints عرض الألعاب تتضمن الآن حقل `currency`
- APIs الإدارية تدعم تحديد وتحديث العملة
- التوافق الكامل مع الكود الحالي

## الملفات المحدثة

1. **Game Schema** (`src/DB/models/Game/game.schema.ts`)
   - إضافة `Currency` enum
   - إضافة حقل `currency`

2. **Game DTOs** (`src/modules/SuperAdmin/game/dto/index.ts`)
   - دعم `currency` في `CreateGameDto`
   - دعم `currency` في `UpdateGameDto`

3. **Admin Game Service** (`src/modules/SuperAdmin/game/game.service.ts`)
   - منطق تعيين العملة الافتراضية
   - دعم تحديث العملة

4. **Public Game Service** (`src/modules/game/game.service.ts`)
   - إضافة `currency` في جميع استعلامات العرض
   - تحديث select statements

## الخلاصة

النظام الآن يدعم بشكل كامل تحديد العملة لكل لعبة، مما يوفر:
- **مرونة أكبر** في إدارة الأسعار
- **تجربة مستخدم محسنة** مع عرض واضح للعملات
- **دعم دولي** للأسواق المختلفة
- **توافق كامل** مع النظام الحالي

جميع التحديثات تم تطبيقها بعناية للحفاظ على استقرار النظام وضمان التوافق مع البيانات الموجودة.